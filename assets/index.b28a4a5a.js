var H=Object.defineProperty,R=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var F=(r,i,l)=>i in r?H(r,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[i]=l,B=(r,i)=>{for(var l in i||(i={}))G.call(i,l)&&F(r,l,i[l]);if(E)for(var l of E(i))K.call(i,l)&&F(r,l,i[l]);return r},j=(r,i)=>R(r,z(i));import{j as s,F as b,M as I,a as f,C as S,I as D,b as v,H as J,R as C,c as Q}from"./vendor.ca307380.js";import"https://renbaoshuo.github.io/OIerDb-data-generator/static.js";import"https://renbaoshuo.github.io/OIerDb-data-generator/result.sha512.js";const U=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))p(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&p(m)}).observe(document,{childList:!0,subtree:!0});function l(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerpolicy&&(u.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?u.credentials="include":a.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function p(a){if(a.ep)return;a.ep=!0;const u=l(a);fetch(a.href,u)}};U();var V=()=>s(b,{children:s(I,{fixed:"top",borderless:!0,children:f(S,{children:[s(I.Item,{children:s("div",{style:{fontSize:"20px"},children:s("b",{children:"OIerDb"})})}),s(I.Item,{position:"right",as:"a",href:"https://github.com/renbaoshuo/OIerDb-frontend",target:"_blank",style:{fontSize:"1.25rem"},icon:!0,children:s(D,{name:"github"})})]})})});function X(){return s(b,{children:f(v,{info:!0,children:[s(D,{loading:!0,name:"sync alternate"}),"\u6B63\u5728\u521D\u59CB\u5316 OIerDb..."]})})}function Y(){return s(b,{children:f(v,{error:!0,children:[s(D,{name:"remove"}),"\u521D\u59CB\u5316 OIerDb \u65F6\u51FA\u73B0\u4E86\u9519\u8BEF\uFF0C\u8BF7\u6253\u5F00\u63A7\u5236\u53F0\u4EE5\u83B7\u53D6\u8BE6\u7EC6\u4FE1\u606F\u3002"]})})}function Z(){return f(b,{children:[s(J,{as:"h3",dividing:!0,children:"\u8BF7\u66F4\u65B0\u6D4F\u89C8\u5668"}),f("div",{children:[f(v,{error:!0,children:[s(D,{name:"remove"}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 ",s("code",{children:"indexedDB"}),"\u3002"]}),f("p",{children:["\u63A8\u8350\u4F7F\u7528\u6700\u65B0\u7248\u7684"," ",s("a",{href:"https://www.google.cn/chrome/",target:"_blank",children:"Google Chrome \u6D4F\u89C8\u5668"})," ","\u8BBF\u95EE OIerDb NG\u3002"]})]})]})}(()=>{let r=Object.create(null),i=!0,l;Object.defineProperty(globalThis,"OIerDb",{enumerable:!0,value:r}),Object.defineProperty(r,"provinces",{enumerable:!0,value:["\u5B89\u5FBD","\u5317\u4EAC","\u798F\u5EFA","\u7518\u8083","\u5E7F\u4E1C","\u5E7F\u897F","\u8D35\u5DDE","\u6D77\u5357","\u6CB3\u5317","\u6CB3\u5357","\u9ED1\u9F99\u6C5F","\u6E56\u5317","\u6E56\u5357","\u5409\u6797","\u6C5F\u82CF","\u6C5F\u897F","\u8FBD\u5B81","\u5185\u8499\u53E4","\u5C71\u4E1C","\u5C71\u897F","\u9655\u897F","\u4E0A\u6D77","\u56DB\u5DDD","\u5929\u6D25","\u65B0\u7586","\u6D59\u6C5F","\u91CD\u5E86","\u5B81\u590F","\u4E91\u5357","\u6FB3\u95E8","\u9999\u6E2F","\u9752\u6D77","\u897F\u85CF","\u53F0\u6E7E"]}),Object.defineProperty(r,"award_levels",{enumerable:!0,value:["\u91D1\u724C","\u94F6\u724C","\u94DC\u724C","\u4E00\u7B49\u5956","\u4E8C\u7B49\u5956","\u4E09\u7B49\u5956","\u56FD\u9645\u91D1\u724C","\u56FD\u9645\u94F6\u724C","\u56FD\u9645\u94DC\u724C"]});function p(c,t,e){let n=Object.entries(c).sort((o,h)=>o[1]!==h[1]?e*(h[1]-o[1]):o[0]<h[0]?-1:o[0]>h[0]?1:0);return typeof t=="number"?n.slice(0,t):n}Object.defineProperty(r,"Counter",{enumerable:!0,value:class{constructor(){this.dict=Object.create(null)}clear(){for(let t in this.dict)delete this.dict[t]}get(t){var e;return(e=this.dict[t])!=null?e:0}least_common(t){return p(this.dict,t,-1)}length(){return Object.keys(this.dict).length}most_common(t){return p(this.dict,t,1)}update(t,e=1){t in this.dict||(this.dict[t]=0),this.dict[t]+=e}}}),Object.defineProperty(r,"Contest",{enumerable:!0,value:class{constructor(t,e){this.id=t;for(let n in e)this[n]=e[n];this.contestants=[],this.level_counts=new r.Counter}school_year(){return this.year-!this.fall_semester}n_contestants(){return this.capacity?this.capacity:this.contestants.length}}}),Object.defineProperty(r,"School",{enumerable:!0,value:class{constructor(t,e){this.id=t,this.rank=0,[this.name,this.province,this.city,this.score]=e,this.members=[],this.records=[],this.award_counts={},r.contests.forEach(n=>{n.type in this.award_counts||(this.award_counts[n.type]={}),n.year in this.award_counts[n.type]||(this.award_counts[n.type][n.year]=new r.Counter)})}}});async function a(){if(!(await indexedDB.databases()).find(e=>e.name==="OIerDb"))throw Error("\u672A\u627E\u5230\u6570\u636E\u5E93");let t=(await new Promise((e,n)=>{let o=indexedDB.open("OIerDb");o.onerror=n,o.onsuccess=()=>e(o.result),o.onupgradeneeded=()=>n("\u6570\u636E\u5E93\u7248\u672C\u4E0D\u7B26")})).transaction("main").objectStore("main");return new Promise((e,n)=>{let o=t.get("oiers");o.onerror=n,o.onsuccess=()=>e(o.result)})}async function u(c){let t,e=0;for(;t=await new Promise((o,h)=>{let d=indexedDB.open("OIerDb");d.onerror=h,d.onsuccess=()=>o(d.result),d.onupgradeneeded=()=>{let g=d.result;g.objectStoreNames.contains("main")||g.createObjectStore("main")}}),!t.objectStoreNames.contains("main");){if(++e>10)throw Error("\u6570\u636E\u5E93\u7ED3\u6784\u65E0\u6CD5\u4FEE\u590D");console.log(`\u6570\u636E\u5E93\u7ED3\u6784\u635F\u574F\uFF0C\u6B63\u5728\u4FEE\u590D\u4E2D\uFF0C\u8BF7\u7A0D\u7B49\u76F4\u81F3\u4FEE\u590D\u5B8C\u6210\u7684\u6D88\u606F (${e}/10) ...`),await new Promise((o,h)=>{let d=indexedDB.deleteDatabase("OIerDb");d.onerror=h,d.onsuccess=o})}e&&console.log("\u6570\u636E\u5E93\u4FEE\u590D\u5B8C\u6210\uFF0C\u51C6\u5907\u5199\u5165\u3002");let n=t.transaction("main","readwrite").objectStore("main");return new Promise((o,h)=>{let d=n.put(c,"oiers");d.onerror=h,d.onsuccess=o})}function m(){const c=function(e,n){e.contestants.push(n),e.level_counts.update(n.level)},t=function(e,n){e.records.push(n),e.members.push(n.oier),e.award_counts[n.contest.type][n.contest.year].update(n.level)};return r.contests.forEach(e=>{e.length=0,e.level_counts.clear()}),r.schools.forEach(e=>{e.members.length=0,e.records.length=0,r.contests.forEach(n=>e.award_counts[n.type][n.year].clear())}),r.oiers.forEach(e=>{e.provinces=Array.from(new Set(e.records.map(n=>n.province))),e.records.forEach(n=>{n.contest=r.contests[n.contest],n.school=l[n.school],n.oier=e,c(n.contest,n),t(n.school,n)})}),r.contests.forEach(e=>e.contestants.sort((n,o)=>n.rank-o.rank)),r.schools.forEach(e=>e.members=Array.from(new Set(e.members))),!0}function x(c){let t=[];return c.split(`
`).forEach(e=>{let n=e.split(",");if(n.length!==9)return;let[o,h,d,g,P,_,L,k,A]=n,M=A.split("/").map(q=>{let[W,T,w,$,y,O]=q.split(":");return j(B({contest:W,school:T},w!==""&&{score:parseFloat(w)}),{rank:parseInt($),province:y in r.provinces?r.provinces[y]:y,level:O in r.award_levels?r.award_levels[O]:O})});_=parseFloat(_);let N={rank:t.length&&_===t[t.length-1].oierdb_score?t[t.length-1].rank:t.length,uid:parseInt(o),initials:h,name:d,gender:parseInt(g),enroll_middle:parseInt(P),oierdb_score:_,ccf_score:parseFloat(L),ccf_level:parseInt(k),records:M};t.push(N)}),t}r.init=async function(){let c=console.time&&console.timeEnd;c&&console.time("\u9884\u5904\u7406\u65F6\u957F"),i&&(r.contests=r.contests.map((t,e)=>new r.Contest(e,t)),r.schools=r.schools.map((t,e)=>new r.School(e,t)),l=r.schools.concat(),r.schools=r.schools.filter(t=>t.name).sort((t,e)=>t.score!==e.score?e.score-t.score:t.id-e.id),r.schools.forEach((t,e)=>t.rank=e&&t.score===r.schools[e-1].score?r.schools[e-1].rank:e),i=!1);try{if(localStorage.data_sha512===r.upstream_sha512)try{return r.oiers=await a(),m()}catch(e){console.log(`\u65E7\u6570\u636E\u53D7\u635F\uFF0C\u539F\u56E0\uFF1A${e.message}\uFF0C\u91CD\u65B0\u8BFB\u53D6\u4E2D...`)}let t=await(await fetch("https://renbaoshuo.github.io/OIerDb-data-generator/result.txt")).text();return r.oiers=x(t),await u(r.oiers),m()&&(localStorage.data_sha512=r.upstream_sha512),!0}catch(t){console.log(`\u9884\u5904\u7406\u5931\u8D25\uFF0C\u539F\u56E0\uFF1A${t.message}`)}finally{c&&console.timeEnd("\u9884\u5904\u7406\u65F6\u957F")}return!1},r.ofInitials=function(c,t=0){var n;let e=r.oiers.filter(o=>o.initials===c);return t<0&&(t+=e.length),(n=e[t])!=null?n:e}})();const ee=!globalThis||!globalThis.indexedDB;class te extends C.Component{constructor(i){super(i);this.state={loadedOIerDb:!1,errorWhenLoadingOIerDb:!1}}async componentDidMount(){await OIerDb.init()?this.setState({loadedOIerDb:!0,errorWhenLoadingOIerDb:!1}):this.setState({loadedOIerDb:!1,errorWhenLoadingOIerDb:!0})}render(){return ee?s(Z,{}):!this.state.loadedOIerDb&&this.state.errorWhenLoadingOIerDb?s(Y,{}):this.state.loadedOIerDb?s(b,{children:s("div",{children:"Loaded OIerDb."})}):s(X,{})}}Q.render(f(C.StrictMode,{children:[s(V,{}),s(S,{style:{paddingTop:"15px"},children:s(te,{})})]}),document.getElementById("app"));
